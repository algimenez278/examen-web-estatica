---
const { initialTime = 50, timeOut, extraClass = "" } = Astro.props;
---

<div class="timer">
  <span id="remaining-time">{initialTime}</span> seconds
</div>

<style>
  .timer {
    font-size: 1rem;
    font-weight: bold;
    color: #e74c3c;
    margin: 1rem 0;
    padding: 0.5rem 1.5rem;
    background-color: var(--moss);
    border-radius: 0.2rem;
    display: inline-block;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
</style>

<script type="module">
  document.addEventListener('DOMContentLoaded', () => {
    const remainingTimeEl = document.getElementById('remaining-time');
    let remainingTime = parseInt(remainingTimeEl.textContent);

    const interval = setInterval(() => {
      remainingTime--;
      remainingTimeEl.textContent = remainingTime;
      
      // Cambiar color cuando queda poco tiempo
      if (remainingTime <= 30) {
        remainingTimeEl.parentElement.style.color = '#e74c3c';
      }

      // ⏰ Cuando se acaba el tiempo
      if (remainingTime <= 0) {
        clearInterval(interval);

        // Disparar evento global
        const event = new Event('timer-finished');
        document.dispatchEvent(event);

        // Llamar a función externa si está definida
        if (typeof timeOut === 'function') {
          timeOut();
        }
      }
    }, 1000);
  });
</script>
